{"remainingRequest":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue","mtime":1618578150001},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KCmltcG9ydCB7IG1hcE11dGF0aW9ucywgbWFwU3RhdGUgfSBmcm9tICd2dWV4JwppbXBvcnQgdXNlSWZyYW1lQ29udHJvbCBmcm9tICcuLi8uLi9ob29rcy9pZnJhbWUnCmltcG9ydCBCb3ggZnJvbSAnLi9jb21wb25lbnRzL0JveCcKCmltcG9ydCBXaWRnZXRVc2VDYXNlIGZyb20gJy4uLy4uL2FyY2gvd2lkZ2V0L3VzZWNhc2UnCmNvbnN0IHdpZGdldFVzZUNhc2UgPSBuZXcgV2lkZ2V0VXNlQ2FzZSgpCgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogeyBCb3ggfSwKICBwcm9wczogewogICAgY29uZmlnOiBPYmplY3QKICB9LAogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgd2lkZ2V0OiBudWxsLAogICAgICBzaG93OiBmYWxzZQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKHsKICAgICAgY3VzdG9tZXI6IHN0YXRlID0+IHN0YXRlLnN1cnZleS5jdXN0b21lciwKICAgICAgdG9rZW46IHN0YXRlID0+IHN0YXRlLnN1cnZleS50b2tlbgogICAgfSkKICB9LAogIG1ldGhvZHM6IHsKICAgIC4uLm1hcE11dGF0aW9ucyh7CiAgICAgIHNldFRva2VuOiAnc3VydmV5L3NldFRva2VuJywKICAgICAgc2V0Q3VzdG9tZXI6ICdzdXJ2ZXkvc2V0Q3VzdG9tZXInCiAgICB9KSwKICAgIGFzeW5jIGdldFdpZGdldCAoKSB7CiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgd2lkZ2V0VXNlQ2FzZS5nZXRPbmUodGhpcy50b2tlbikKICAgICAgdGhpcy53aWRnZXQgPSByZXNwb25zZQoKICAgICAgLy9SZW1vdmUgbm9uIHF1ZXN0aW9uIGl0ZW1zCiAgICAgIHRoaXMud2lkZ2V0ID0gd2lkZ2V0VXNlQ2FzZS5yZW1vdmVOb25RdWVzdGlvbkl0ZW1zKHRoaXMud2lkZ2V0KQoKICAgICAgLy9TZXQgdXNlciBsYW5ndWFnZQogICAgICB3aWRnZXRVc2VDYXNlLnNldExhbmd1YWdlKHRoaXMud2lkZ2V0KQogICAgfSwKICAgIGdldElmcmFtZURhdGEgKCkgewogICAgICBjb25zdCBpZnJhbWUgPSB1c2VJZnJhbWVDb250cm9sKCkKICAgICAgaWZyYW1lLnVwZGF0ZURhdGFMaXN0ZW5lcigpCiAgICAgIGlmcmFtZS5nZXRUb2tlbktleSgpCiAgICB9LAogICAgZ2V0Q29uZmlnRGF0YSAoKSB7CiAgICAgIGlmICh0aGlzLmNvbmZpZykgewogICAgICAgIHRoaXMuc2V0VG9rZW4odGhpcy5jb25maWcua2V5KQogICAgICAgIHRoaXMuc2V0Q3VzdG9tZXIodGhpcy5jb25maWcuY3VzdG9tZXIpCiAgICAgIH0KICAgIH0sCiAgICBzaG93V2lkZ2V0QnlVc2VyICgpIHsKICAgICAgcmV0dXJuIHdpZGdldFVzZUNhc2UuY2FuU2hvdyh0aGlzLndpZGdldCkKICAgIH0sCiAgICBhc3luYyBzZXR1cCAoKSB7CiAgICAgIHRoaXMuZ2V0SWZyYW1lRGF0YSgpIC8vR2V0IGRhdGEgaW4gaWZyYW1lCiAgICAgIHRoaXMuZ2V0Q29uZmlnRGF0YSgpIC8vR2V0IGRhdGEgaW4gY2xhc3MgY29uZmlnIAogICAgICBhd2FpdCB0aGlzLmdldFdpZGdldCgpCiAgICAgIGNvbnN0IHNob3cgPSB0aGlzLnNob3dXaWRnZXRCeVVzZXIodGhpcy53aWRnZXQpCiAgICAgIGlmICghc2hvdykgewogICAgICAgIHJldHVybgogICAgICB9CgogICAgICBjb25zdCBkZWxheSA9IHRoaXMud2lkZ2V0LmRlbGF5IHx8IDAKICAgICAgY29uc3Qgdm0gPSB0aGlzCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vIHN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICAgICAgdm0uc2hvdyA9IHNob3cKICAgICAgfSwgZGVsYXkgKiAxMDAwKQoKICAgICAgd2lkZ2V0VXNlQ2FzZS5zZXRTaG93QXQoKQogICAgICB3aWRnZXRVc2VDYXNlLnBvc3RPcGVuQ291bnRlcigpCiAgICB9CiAgfSwKICBjcmVhdGVkICgpIHsKICAgIHRoaXMuc2V0dXAoKQogIH0KfQo="},{"version":3,"sources":["Widget.vue"],"names":[],"mappings":";;;;AAIA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Widget.vue","sourceRoot":"src/views/Widget","sourcesContent":["<template>\n  <Box :widget=\"widget\" v-if=\"widget && show\" />\n</template>\n<script>\nimport { mapMutations, mapState } from 'vuex'\nimport useIframeControl from '../../hooks/iframe'\nimport Box from './components/Box'\n\nimport WidgetUseCase from '../../arch/widget/usecase'\nconst widgetUseCase = new WidgetUseCase()\n\nexport default {\n  components: { Box },\n  props: {\n    config: Object\n  },\n  data () {\n    return {\n      widget: null,\n      show: false\n    }\n  },\n  computed: {\n    ...mapState({\n      customer: state => state.survey.customer,\n      token: state => state.survey.token\n    })\n  },\n  methods: {\n    ...mapMutations({\n      setToken: 'survey/setToken',\n      setCustomer: 'survey/setCustomer'\n    }),\n    async getWidget () {\n      const response = await widgetUseCase.getOne(this.token)\n      this.widget = response\n\n      //Remove non question items\n      this.widget = widgetUseCase.removeNonQuestionItems(this.widget)\n\n      //Set user language\n      widgetUseCase.setLanguage(this.widget)\n    },\n    getIframeData () {\n      const iframe = useIframeControl()\n      iframe.updateDataListener()\n      iframe.getTokenKey()\n    },\n    getConfigData () {\n      if (this.config) {\n        this.setToken(this.config.key)\n        this.setCustomer(this.config.customer)\n      }\n    },\n    showWidgetByUser () {\n      return widgetUseCase.canShow(this.widget)\n    },\n    async setup () {\n      this.getIframeData() //Get data in iframe\n      this.getConfigData() //Get data in class config \n      await this.getWidget()\n      const show = this.showWidgetByUser(this.widget)\n      if (!show) {\n        return\n      }\n\n      const delay = this.widget.delay || 0\n      const vm = this\n      setTimeout(() => {\n        // startTime = new Date().getTime()\n        vm.show = show\n      }, delay * 1000)\n\n      widgetUseCase.setShowAt()\n      widgetUseCase.postOpenCounter()\n    }\n  },\n  created () {\n    this.setup()\n  }\n}\n</script>\n"]}]}