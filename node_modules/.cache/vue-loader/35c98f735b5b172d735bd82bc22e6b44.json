{"remainingRequest":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue","mtime":1618598137083},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KCmltcG9ydCB7IG1hcE11dGF0aW9ucywgbWFwU3RhdGUgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IHVzZUlmcmFtZUNvbnRyb2wgZnJvbSAiLi4vLi4vaG9va3MvaWZyYW1lIjsKaW1wb3J0IEJveCBmcm9tICIuL0JveCI7CgppbXBvcnQgV2lkZ2V0VXNlQ2FzZSBmcm9tICIuLi8uLi9hcmNoL3dpZGdldC91c2VjYXNlIjsKY29uc3Qgd2lkZ2V0VXNlQ2FzZSA9IG5ldyBXaWRnZXRVc2VDYXNlKCk7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogeyBCb3ggfSwKICBwcm9wczogewogICAgY29uZmlnOiBPYmplY3QsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgd2lkZ2V0OiBudWxsLAogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBTdGF0ZSh7CiAgICAgIGN1c3RvbWVyOiAoc3RhdGUpID0+IHN0YXRlLnN1cnZleS5jdXN0b21lciwKICAgICAgdG9rZW46IChzdGF0ZSkgPT4gc3RhdGUuc3VydmV5LnRva2VuLAogICAgICBzaG93OiAoc3RhdGUpID0+IHN0YXRlLnN1cnZleS5zaG93LAogICAgfSksCiAgfSwKICBtZXRob2RzOiB7CiAgICAuLi5tYXBNdXRhdGlvbnMoewogICAgICBzZXRUb2tlbjogInN1cnZleS9zZXRUb2tlbiIsCiAgICAgIHNldEN1c3RvbWVyOiAic3VydmV5L3NldEN1c3RvbWVyIiwKICAgICAgc2hvd1dpZGdldDogInN1cnZleS9zaG93V2lkZ2V0IiwKICAgICAgc2V0RWRpdE1vZGU6ICJzdXJ2ZXkvc2V0RWRpdE1vZGUiLAogICAgfSksCiAgICBhc3luYyBnZXRXaWRnZXQoKSB7CiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgd2lkZ2V0VXNlQ2FzZS5nZXRPbmUodGhpcy50b2tlbik7CiAgICAgIHRoaXMud2lkZ2V0ID0gcmVzcG9uc2U7CgogICAgICAvL1JlbW92ZSBub24gcXVlc3Rpb24gaXRlbXMKICAgICAgdGhpcy53aWRnZXQgPSB3aWRnZXRVc2VDYXNlLnJlbW92ZU5vblF1ZXN0aW9uSXRlbXModGhpcy53aWRnZXQpOwoKICAgICAgLy9TZXQgdXNlciBsYW5ndWFnZQogICAgICB3aWRnZXRVc2VDYXNlLnNldExhbmd1YWdlKHRoaXMud2lkZ2V0KTsKICAgIH0sCiAgICBnZXRJZnJhbWVEYXRhKCkgewogICAgICBjb25zdCBpZnJhbWUgPSB1c2VJZnJhbWVDb250cm9sKCk7CiAgICAgIGlmcmFtZS51cGRhdGVEYXRhTGlzdGVuZXIoKTsKICAgICAgaWZyYW1lLmdldFRva2VuS2V5KCk7CiAgICB9LAogICAgZ2V0Q29uZmlnRGF0YSgpIHsKICAgICAgaWYgKHRoaXMuY29uZmlnKSB7CiAgICAgICAgdGhpcy5zZXRUb2tlbih0aGlzLmNvbmZpZy5rZXkpOwogICAgICAgIHRoaXMuc2V0Q3VzdG9tZXIodGhpcy5jb25maWcuY3VzdG9tZXIpOwogICAgICAgIHRoaXMuc2V0RWRpdE1vZGUodGhpcy5jb25maWcuZWRpdCk7CiAgICAgIH0KICAgIH0sCiAgICBzaG93V2lkZ2V0QnlVc2VyKCkgewogICAgICByZXR1cm4gd2lkZ2V0VXNlQ2FzZS5jYW5TaG93KHRoaXMud2lkZ2V0KTsKICAgIH0sCiAgICBhc3luYyBzZXR1cCgpIHsKICAgICAgdGhpcy5nZXRJZnJhbWVEYXRhKCk7IC8vR2V0IGRhdGEgaW4gaWZyYW1lCiAgICAgIHRoaXMuZ2V0Q29uZmlnRGF0YSgpOyAvL0dldCBkYXRhIGluIGNsYXNzIGNvbmZpZwogICAgICBhd2FpdCB0aGlzLmdldFdpZGdldCgpOwogICAgICBjb25zdCBzaG93ID0gdGhpcy5zaG93V2lkZ2V0QnlVc2VyKHRoaXMud2lkZ2V0KTsKICAgICAgaWYgKCFzaG93KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBkZWxheSA9IHRoaXMud2lkZ2V0LmRlbGF5IHx8IDA7CiAgICAgIGNvbnN0IHZtID0gdGhpczsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgLy8gc3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICB2bS5zaG93V2lkZ2V0KHNob3cpOwogICAgICB9LCBkZWxheSAqIDEwMDApOwoKICAgICAgd2lkZ2V0VXNlQ2FzZS5zZXRTaG93QXQoKTsKICAgICAgd2lkZ2V0VXNlQ2FzZS5wb3N0T3BlbkNvdW50ZXIoKTsKICAgIH0sCiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5zZXR1cCgpOwogIH0sCn07Cg=="},{"version":3,"sources":["Widget.vue"],"names":[],"mappings":";;;;AAIA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Widget.vue","sourceRoot":"src/views/Widget","sourcesContent":["<template>\n  <Box :widget=\"widget\" v-if=\"widget && show\" />\n</template>\n<script>\nimport { mapMutations, mapState } from \"vuex\";\nimport useIframeControl from \"../../hooks/iframe\";\nimport Box from \"./Box\";\n\nimport WidgetUseCase from \"../../arch/widget/usecase\";\nconst widgetUseCase = new WidgetUseCase();\n\nexport default {\n  components: { Box },\n  props: {\n    config: Object,\n  },\n  data() {\n    return {\n      widget: null,\n    };\n  },\n  computed: {\n    ...mapState({\n      customer: (state) => state.survey.customer,\n      token: (state) => state.survey.token,\n      show: (state) => state.survey.show,\n    }),\n  },\n  methods: {\n    ...mapMutations({\n      setToken: \"survey/setToken\",\n      setCustomer: \"survey/setCustomer\",\n      showWidget: \"survey/showWidget\",\n      setEditMode: \"survey/setEditMode\",\n    }),\n    async getWidget() {\n      const response = await widgetUseCase.getOne(this.token);\n      this.widget = response;\n\n      //Remove non question items\n      this.widget = widgetUseCase.removeNonQuestionItems(this.widget);\n\n      //Set user language\n      widgetUseCase.setLanguage(this.widget);\n    },\n    getIframeData() {\n      const iframe = useIframeControl();\n      iframe.updateDataListener();\n      iframe.getTokenKey();\n    },\n    getConfigData() {\n      if (this.config) {\n        this.setToken(this.config.key);\n        this.setCustomer(this.config.customer);\n        this.setEditMode(this.config.edit);\n      }\n    },\n    showWidgetByUser() {\n      return widgetUseCase.canShow(this.widget);\n    },\n    async setup() {\n      this.getIframeData(); //Get data in iframe\n      this.getConfigData(); //Get data in class config\n      await this.getWidget();\n      const show = this.showWidgetByUser(this.widget);\n      if (!show) {\n        return;\n      }\n\n      const delay = this.widget.delay || 0;\n      const vm = this;\n      setTimeout(() => {\n        // startTime = new Date().getTime()\n        vm.showWidget(show);\n      }, delay * 1000);\n\n      widgetUseCase.setShowAt();\n      widgetUseCase.postOpenCounter();\n    },\n  },\n  created() {\n    this.setup();\n  },\n};\n</script>\n"]}]}