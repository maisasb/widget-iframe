{"remainingRequest":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue","mtime":1626269920578},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KCmltcG9ydCB7IG1hcE11dGF0aW9ucywgbWFwU3RhdGUgfSBmcm9tICd2dWV4JwppbXBvcnQgdXNlSWZyYW1lQ29udHJvbCBmcm9tICcuLi8uLi9ob29rcy9pZnJhbWUnCmltcG9ydCBCb3ggZnJvbSAnLi9Cb3gnCmltcG9ydCBXaWRnZXRVc2VDYXNlIGZyb20gJy4uLy4uL2FyY2gvd2lkZ2V0L3VzZWNhc2UnCmNvbnN0IHdpZGdldFVzZUNhc2UgPSBuZXcgV2lkZ2V0VXNlQ2FzZSgpCgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQm94LAogIH0sCiAgcHJvcHM6IHsKICAgIGNvbmZpZzogT2JqZWN0LAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJlY3VycmVuY2U6IGZhbHNlLAogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKHsKICAgICAgY3VzdG9tZXI6IHN0YXRlID0+IHN0YXRlLndpZGdldC5jdXN0b21lciwKICAgICAgdG9rZW46IHN0YXRlID0+IHN0YXRlLndpZGdldC50b2tlbiwKICAgICAgc2hvdzogc3RhdGUgPT4gc3RhdGUud2lkZ2V0LnNob3csCiAgICAgIHdpZGdldDogc3RhdGUgPT4gc3RhdGUud2lkZ2V0LndpZGdldCwKICAgIH0pLAogIH0sCiAgbWV0aG9kczogewogICAgLi4ubWFwTXV0YXRpb25zKHsKICAgICAgc2V0VG9rZW46ICd3aWRnZXQvc2V0VG9rZW4nLAogICAgICBzZXRDdXN0b21lcjogJ3dpZGdldC9zZXRDdXN0b21lcicsCiAgICAgIHNob3dXaWRnZXQ6ICd3aWRnZXQvc2hvd1dpZGdldCcsCiAgICAgIHNldEVkaXRNb2RlOiAnd2lkZ2V0L3NldEVkaXRNb2RlJywKICAgICAgc2V0V2lkZ2V0OiAnd2lkZ2V0L3NldFdpZGdldCcsCiAgICB9KSwKICAgIGFzeW5jIGdldEN1c3RvbWVyUmVjdXJyZW5jZSgpIHsKICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3aWRnZXRVc2VDYXNlLmNoZWNrQ3VzdG9tZXJSZWN1cnJlbmNlKHRoaXMudG9rZW4sIHRoaXMuY3VzdG9tZXIpCiAgICAgIHRoaXMucmVjdXJyZW5jZSA9IHJlc3BvbnNlLnF1YXJhbnRpbmUKICAgIH0sCiAgICBhc3luYyBnZXRXaWRnZXQoKSB7CiAgICAgIGlmICh0aGlzLnJlY3VycmVuY2UpIHsKICAgICAgICBjb25zb2xlLmxvZygnW1dpZGdldF0gY3VzdG9tZXIgaW4gcmVjdXJyZW5jZSBydWxlJykKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHdpZGdldFVzZUNhc2UuZ2V0T25lKHRoaXMudG9rZW4pCgogICAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIC8vUmVtb3ZlIG5vbiBxdWVzdGlvbiBpdGVtcwogICAgICBjb25zdCB3aWRnZXQgPSB3aWRnZXRVc2VDYXNlLnJlbW92ZU5vblF1ZXN0aW9uSXRlbXMocmVzcG9uc2UpCgogICAgICB0aGlzLnNldFdpZGdldCh3aWRnZXQpCiAgICB9LAogICAgZ2V0SWZyYW1lRGF0YSgpIHsKICAgICAgY29uc3QgaWZyYW1lID0gdXNlSWZyYW1lQ29udHJvbCgpCiAgICAgIGlmcmFtZS51cGRhdGVEYXRhTGlzdGVuZXIoKQogICAgICBpZnJhbWUuZ2V0VG9rZW5LZXkoKQogICAgfSwKICAgIGdldENvbmZpZ0RhdGEoKSB7CiAgICAgIGlmICh0aGlzLmNvbmZpZykgewogICAgICAgIHRoaXMuc2V0VG9rZW4odGhpcy5jb25maWcua2V5KQogICAgICAgIHRoaXMuc2V0Q3VzdG9tZXIodGhpcy5jb25maWcuY3VzdG9tZXIpCiAgICAgICAgdGhpcy5zZXRFZGl0TW9kZSh0aGlzLmNvbmZpZy5lZGl0KQogICAgICB9CiAgICB9LAogICAgc2hvd1dpZGdldEJ5VXNlcigpIHsKICAgICAgcmV0dXJuIHdpZGdldFVzZUNhc2UuY2FuU2hvdyh0aGlzLndpZGdldCkKICAgIH0sCiAgICBhc3luYyBzZXR1cCgpIHsKICAgICAgdGhpcy5nZXRJZnJhbWVEYXRhKCkgLy9HZXQgZGF0YSBpbiBpZnJhbWUKICAgICAgdGhpcy5nZXRDb25maWdEYXRhKCkgLy9HZXQgZGF0YSBpbiBjbGFzcyBjb25maWcKICAgICAgaWYgKHRoaXMuY3VzdG9tZXIpIHsKICAgICAgICAvL0NoZWNrIGlmIGN1c3RvbWVyIGlzIGluIHJlY3VycmVuY2UgcnVsZQogICAgICAgIGF3YWl0IHRoaXMuZ2V0Q3VzdG9tZXJSZWN1cnJlbmNlKCkKICAgICAgfQogICAgICBhd2FpdCB0aGlzLmdldFdpZGdldCgpCiAgICAgIGlmICghdGhpcy53aWRnZXQpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBjb25zdCBzaG93ID0gdGhpcy5zaG93V2lkZ2V0QnlVc2VyKHRoaXMud2lkZ2V0KQogICAgICBpZiAoIXNob3cpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgY29uc3QgZGVsYXkgPSB0aGlzLndpZGdldC5kZWxheSB8fCAwCiAgICAgIGNvbnN0IHZtID0gdGhpcwogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKQogICAgICAgIHZtLnNob3dXaWRnZXQoc2hvdykKICAgICAgfSwgZGVsYXkgKiAxMDAwKQoKICAgICAgd2lkZ2V0VXNlQ2FzZS5zZXRTaG93QXQoKQogICAgICB3aWRnZXRVc2VDYXNlLnBvc3RPcGVuQ291bnRlcigpCiAgICB9LAogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuc2V0dXAoKQogIH0sCn0K"},{"version":3,"sources":["Widget.vue"],"names":[],"mappings":";;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Widget.vue","sourceRoot":"src/views/Widget","sourcesContent":["<template>\n  <Box :widget=\"widget\" v-if=\"widget && show\" />\n</template>\n<script>\nimport { mapMutations, mapState } from 'vuex'\nimport useIframeControl from '../../hooks/iframe'\nimport Box from './Box'\nimport WidgetUseCase from '../../arch/widget/usecase'\nconst widgetUseCase = new WidgetUseCase()\n\nexport default {\n  components: {\n    Box,\n  },\n  props: {\n    config: Object,\n  },\n  data() {\n    return {\n      recurrence: false,\n    }\n  },\n  computed: {\n    ...mapState({\n      customer: state => state.widget.customer,\n      token: state => state.widget.token,\n      show: state => state.widget.show,\n      widget: state => state.widget.widget,\n    }),\n  },\n  methods: {\n    ...mapMutations({\n      setToken: 'widget/setToken',\n      setCustomer: 'widget/setCustomer',\n      showWidget: 'widget/showWidget',\n      setEditMode: 'widget/setEditMode',\n      setWidget: 'widget/setWidget',\n    }),\n    async getCustomerRecurrence() {\n      const response = await widgetUseCase.checkCustomerRecurrence(this.token, this.customer)\n      this.recurrence = response.quarantine\n    },\n    async getWidget() {\n      if (this.recurrence) {\n        console.log('[Widget] customer in recurrence rule')\n        return\n      }\n      const response = await widgetUseCase.getOne(this.token)\n\n      if (!response) {\n        return\n      }\n\n      //Remove non question items\n      const widget = widgetUseCase.removeNonQuestionItems(response)\n\n      this.setWidget(widget)\n    },\n    getIframeData() {\n      const iframe = useIframeControl()\n      iframe.updateDataListener()\n      iframe.getTokenKey()\n    },\n    getConfigData() {\n      if (this.config) {\n        this.setToken(this.config.key)\n        this.setCustomer(this.config.customer)\n        this.setEditMode(this.config.edit)\n      }\n    },\n    showWidgetByUser() {\n      return widgetUseCase.canShow(this.widget)\n    },\n    async setup() {\n      this.getIframeData() //Get data in iframe\n      this.getConfigData() //Get data in class config\n      if (this.customer) {\n        //Check if customer is in recurrence rule\n        await this.getCustomerRecurrence()\n      }\n      await this.getWidget()\n      if (!this.widget) {\n        return\n      }\n      const show = this.showWidgetByUser(this.widget)\n      if (!show) {\n        return\n      }\n\n      const delay = this.widget.delay || 0\n      const vm = this\n      setTimeout(() => {\n        // startTime = new Date().getTime()\n        vm.showWidget(show)\n      }, delay * 1000)\n\n      widgetUseCase.setShowAt()\n      widgetUseCase.postOpenCounter()\n    },\n  },\n  created() {\n    this.setup()\n  },\n}\n</script>\n"]}]}