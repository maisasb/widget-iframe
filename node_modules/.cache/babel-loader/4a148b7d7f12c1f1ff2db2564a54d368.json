{"remainingRequest":"/home/track/workplace/widget-iframe/node_modules/babel-loader/lib/index.js!/home/track/workplace/widget-iframe/node_modules/eslint-loader/index.js??ref--13-0!/home/track/workplace/widget-iframe/src/arch/widget/usecase.js","dependencies":[{"path":"/home/track/workplace/widget-iframe/src/arch/widget/usecase.js","mtime":1627557404860},{"path":"/home/track/workplace/widget-iframe/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/widget-iframe/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/widget-iframe/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9ob21lL3RyYWNrL3dvcmtwbGFjZS93aWRnZXQtaWZyYW1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvaG9tZS90cmFjay93b3JrcGxhY2Uvd2lkZ2V0LWlmcmFtZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9ob21lL3RyYWNrL3dvcmtwbGFjZS93aWRnZXQtaWZyYW1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0IFdpZGdldFNlcnZpY2UgZnJvbSAnLi9zZXJ2aWNlJzsKaW1wb3J0IGNvbnN0cyBmcm9tICcuLi8uLi9jb25zdHMnOwppbXBvcnQgc3RvcmUgZnJvbSAnLi4vLi4vc3RvcmUvaW5kZXgnOwppbXBvcnQgeyBnZXRVc2VyTGFuZ3VhZ2UsIGdldFN1cnZleUxhbmd1YWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvbGFuZ3VhZ2UnOwovKioKICogU2V0IHdpZGdldFN0b3JhZ2UgaW4gbG9jYWxTdG9yYWdlCiAqIHNob3dfYXQgPSB0aW1lc3RhbXAgdGhhdCB3aWRnZXQgd2FzIHZpZXcgYnkgdXNlcgogKiBhbnN3ZXJlZF9hdCA9IHRpbWVzdGFtcCB0aGF0IHVzZXIgYW5zd2VyIHRoZSB3aWRnZXQKICogQHBhcmFtIHt3aWRnZXRTdG9yYWdlfSB3aWRnZXRTdG9yYWdlCiAqLwoKdmFyIHNldFN0b3JhZ2UgPSBmdW5jdGlvbiBzZXRTdG9yYWdlKHdpZGdldFN0b3JhZ2UpIHsKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yZS5zdGF0ZS53aWRnZXQud2lkZ2V0LnB1YmxpY19oYXNoICsgc3RvcmUuc3RhdGUud2lkZ2V0LndpZGdldC5zdXJ2ZXlfcHVibGljX2hhc2gsIEpTT04uc3RyaW5naWZ5KHdpZGdldFN0b3JhZ2UpKTsKfTsKLyoqCiAqIEdldCB3aWRnZXRTdG9yYWdlIGluIGxvY2FsU3RvcmFnZQogKi8KCgp2YXIgZ2V0U3RvcmFnZSA9IGZ1bmN0aW9uIGdldFN0b3JhZ2UoKSB7CiAgdmFyIHdpZGdldFN0b3JhZ2UgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JlLnN0YXRlLndpZGdldC53aWRnZXQucHVibGljX2hhc2ggKyBzdG9yZS5zdGF0ZS53aWRnZXQud2lkZ2V0LnN1cnZleV9wdWJsaWNfaGFzaCkpOwogIHJldHVybiB3aWRnZXRTdG9yYWdlOwp9OwoKdmFyIFdpZGdldFVzZUNhc2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFdpZGdldFVzZUNhc2UoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV2lkZ2V0VXNlQ2FzZSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoV2lkZ2V0VXNlQ2FzZSwgW3sKICAgIGtleTogImdldE9uZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T25lKHRva2VuKSB7CiAgICAgIHZhciB3aWRnZXRTZXJ2aWNlID0gbmV3IFdpZGdldFNlcnZpY2UoKTsKICAgICAgcmV0dXJuIHdpZGdldFNlcnZpY2UuZ2V0T25lKHRva2VuKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjYW5TaG93IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5TaG93KHdpZGdldCkgewogICAgICB2YXIgd2lkZ2V0U3RvcmFnZSA9IGdldFN0b3JhZ2UoKTsKCiAgICAgIGlmICghd2lkZ2V0U3RvcmFnZSkgewogICAgICAgIC8vIERvbnQgaGF2ZSBzdG9yYWdlIHNldHRlZCwgc2hvdyB3aWRnZXQKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHdpZGdldC5zaG93X3dpZGdldCA9PT0gY29uc3RzLlNIT1dfV0lER0VULk9OQ0UpIHsKICAgICAgICAvLyBJZiBoYXZlIHN0b3JhZ2UgYW5kIGlzIHNldHRlZCwgZG9uJ3Qgc2hvdyB3aWRnZXQKICAgICAgICBpZiAod2lkZ2V0U3RvcmFnZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHdpZGdldC5zaG93X3dpZGdldCA9PT0gY29uc3RzLlNIT1dfV0lER0VULlJFQ1VSUkVOVExZKSB7CiAgICAgICAgdmFyIHNob3cgPSBmYWxzZTsKCiAgICAgICAgaWYgKHdpZGdldFN0b3JhZ2UuYW5zd2VyZWRfYXQpIHsKICAgICAgICAgIC8vIENoZWNrIGRheXMgb2YgcmVzcG9uc2UgaXMgbW9yZSB0aGFuIGNvbmRpdGlvbgogICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh3aWRnZXRTdG9yYWdlLmFuc3dlcmVkX2F0KTsKICAgICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIHdpZGdldC5kYXlzX2FmdGVyX3Jlc3BvbnNlKTsKCiAgICAgICAgICBpZiAobmV3IERhdGUoKS5nZXRUaW1lKCkgPj0gZGF0ZS5nZXRUaW1lKCkpIHsKICAgICAgICAgICAgc2hvdyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAod2lkZ2V0U3RvcmFnZS5zaG93X2F0ICYmICF3aWRnZXRTdG9yYWdlLmFuc3dlcmVkX2F0KSB7CiAgICAgICAgICAvLyBDaGVjayBkYXlzIG9mIGRlY2xpbmUgaXMgbW9yZSB0aGFuIGNvbmRpdGlvbgogICAgICAgICAgdmFyIF9kYXRlID0gbmV3IERhdGUod2lkZ2V0U3RvcmFnZS5zaG93X2F0KTsKCiAgICAgICAgICBfZGF0ZS5zZXREYXRlKF9kYXRlLmdldERhdGUoKSArIHdpZGdldC5kYXlzX2FmdGVyX2RlY2xpbmUpOwoKICAgICAgICAgIGlmIChuZXcgRGF0ZSgpLmdldFRpbWUoKSA+PSBfZGF0ZS5nZXRUaW1lKCkpIHsKICAgICAgICAgICAgc2hvdyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2hvdzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0U2hvd0F0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTaG93QXQoKSB7CiAgICAgIHZhciB3aWRnZXRTdG9yYWdlID0gZ2V0U3RvcmFnZSgpOwoKICAgICAgaWYgKCF3aWRnZXRTdG9yYWdlKSB7CiAgICAgICAgc2V0U3RvcmFnZSh7CiAgICAgICAgICBzaG93X2F0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbnN3ZXJlZCBhdCBpbiBsb2NhbFN0b3JhZ2UKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXRBbnN3ZXJlZEF0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRBbnN3ZXJlZEF0KCkgewogICAgICB2YXIgd2lkZ2V0U3RvcmFnZSA9IGdldFN0b3JhZ2UoKTsKCiAgICAgIGlmICghd2lkZ2V0U3RvcmFnZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgd2lkZ2V0U3RvcmFnZS5hbnN3ZXJlZF9hdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICBzZXRTdG9yYWdlKHdpZGdldFN0b3JhZ2UpOwogICAgfQogIH0sIHsKICAgIGtleTogInBvc3RPcGVuQ291bnRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcG9zdE9wZW5Db3VudGVyKCkgewogICAgICB2YXIgd2lkZ2V0U2VydmljZSA9IG5ldyBXaWRnZXRTZXJ2aWNlKCk7CiAgICAgIHdpZGdldFNlcnZpY2UucG9zdE9wZW5Db3VudGVyKHN0b3JlLnN0YXRlLndpZGdldC53aWRnZXQucHVibGljX2hhc2gpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgbm9uIHF1ZXN0aW9uIGl0ZW1zIGZyb20gc3VydmV5CiAgICAgKiBMaWtlIElNQUdFIGFuZCBMQUJFTAogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZU5vblF1ZXN0aW9uSXRlbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZU5vblF1ZXN0aW9uSXRlbXMod2lkZ2V0KSB7CiAgICAgIGlmICh3aWRnZXQuc3VydmV5Lmp1bXBfcnVsZXNfZW5hYmxlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgd2lkZ2V0LnN1cnZleS5pdGVtcyA9IHdpZGdldC5zdXJ2ZXkuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udHlwZSAhPT0gY29uc3RzLlFVRVNUSU9OX1RZUEUuTEFCRUwgJiYgaXRlbS50eXBlICE9PSBjb25zdHMuUVVFU1RJT05fVFlQRS5JTUFHRTsKICAgICAgfSk7CiAgICAgIHJldHVybiB3aWRnZXQ7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TGFuZ3VhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldExhbmd1YWdlKHdpZGdldCkgewogICAgICB2YXIgdXNlckxhbmcgPSBnZXRVc2VyTGFuZ3VhZ2UoKTsKICAgICAgdmFyIGxhbmcgPSBnZXRTdXJ2ZXlMYW5ndWFnZSh1c2VyTGFuZywgd2lkZ2V0KTsKICAgICAgcmV0dXJuIGxhbmc7CiAgICB9CiAgfSwgewogICAga2V5OiAicG9zdFBhcnRpYWxBbnN3ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3N0UGFydGlhbEFuc3dlciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShzdXJ2ZXlQdWJsaWNIYXNoLCBhbnN3ZXJzKSB7CiAgICAgICAgdmFyIHdpZGdldFNlcnZpY2UsIHJlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHdpZGdldFNlcnZpY2UgPSBuZXcgV2lkZ2V0U2VydmljZSgpOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gd2lkZ2V0U2VydmljZS5wb3N0UGFydGlhbEFuc3dlcihzdXJ2ZXlQdWJsaWNIYXNoLCBhbnN3ZXJzKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgdGhpcy5zZXRBbnN3ZXJlZEF0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwb3N0UGFydGlhbEFuc3dlcihfeCwgX3gyKSB7CiAgICAgICAgcmV0dXJuIF9wb3N0UGFydGlhbEFuc3dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9zdFBhcnRpYWxBbnN3ZXI7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJwb3N0Q29tcGxldGVBbnN3ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3N0Q29tcGxldGVBbnN3ZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKHN1cnZleVB1YmxpY0hhc2gsIGFuc3dlcnMpIHsKICAgICAgICB2YXIgd2lkZ2V0U2VydmljZSwgcmVzcG9uc2U7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHdpZGdldFNlcnZpY2UgPSBuZXcgV2lkZ2V0U2VydmljZSgpOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHdpZGdldFNlcnZpY2UucG9zdENvbXBsZXRlQW5zd2VyKHN1cnZleVB1YmxpY0hhc2gsIGFuc3dlcnMpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgdGhpcy5zZXRBbnN3ZXJlZEF0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwb3N0Q29tcGxldGVBbnN3ZXIoX3gzLCBfeDQpIHsKICAgICAgICByZXR1cm4gX3Bvc3RDb21wbGV0ZUFuc3dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9zdENvbXBsZXRlQW5zd2VyOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiY2hlY2tDdXN0b21lclJlY3VycmVuY2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrQ3VzdG9tZXJSZWN1cnJlbmNlKHRva2VuLCBjdXN0b21lcikgewogICAgICB2YXIgd2lkZ2V0U2VydmljZSA9IG5ldyBXaWRnZXRTZXJ2aWNlKCk7CiAgICAgIHZhciBkYXRhID0gewogICAgICAgIGN1c3RvbWVyOiBjdXN0b21lcgogICAgICB9OwogICAgICByZXR1cm4gd2lkZ2V0U2VydmljZS5jaGVja0N1c3RvbWVyUmVjdXJyZW5jZSh0b2tlbiwgZGF0YSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gV2lkZ2V0VXNlQ2FzZTsKfSgpOwoKZXhwb3J0IHsgV2lkZ2V0VXNlQ2FzZSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/home/track/workplace/widget-iframe/src/arch/widget/usecase.js"],"names":["WidgetService","consts","store","getUserLanguage","getSurveyLanguage","setStorage","widgetStorage","localStorage","setItem","state","widget","public_hash","survey_public_hash","JSON","stringify","getStorage","parse","getItem","WidgetUseCase","token","widgetService","getOne","show_widget","SHOW_WIDGET","ONCE","RECURRENTLY","show","answered_at","date","Date","setDate","getDate","days_after_response","getTime","show_at","days_after_decline","postOpenCounter","survey","jump_rules_enabled","items","filter","item","type","QUESTION_TYPE","LABEL","IMAGE","userLang","lang","surveyPublicHash","answers","postPartialAnswer","response","setAnsweredAt","postCompleteAnswer","customer","data","checkCustomerRecurrence"],"mappings":"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","sourcesContent":["import WidgetService from './service'\nimport consts from '../../consts'\nimport store from '../../store/index'\nimport { getUserLanguage, getSurveyLanguage } from '../../utils/language'\n\n/**\n * Set widgetStorage in localStorage\n * show_at = timestamp that widget was view by user\n * answered_at = timestamp that user answer the widget\n * @param {widgetStorage} widgetStorage\n */\nconst setStorage = widgetStorage => {\n  localStorage.setItem(\n    store.state.widget.widget.public_hash + store.state.widget.widget.survey_public_hash,\n    JSON.stringify(widgetStorage),\n  )\n}\n/**\n * Get widgetStorage in localStorage\n */\nconst getStorage = () => {\n  const widgetStorage = JSON.parse(\n    localStorage.getItem(store.state.widget.widget.public_hash + store.state.widget.widget.survey_public_hash),\n  )\n  return widgetStorage\n}\n\nexport default class WidgetUseCase {\n  getOne(token) {\n    const widgetService = new WidgetService()\n    return widgetService.getOne(token)\n  }\n  canShow(widget) {\n    const widgetStorage = getStorage()\n    if (!widgetStorage) {\n      // Dont have storage setted, show widget\n      return true\n    }\n\n    if (widget.show_widget === consts.SHOW_WIDGET.ONCE) {\n      // If have storage and is setted, don't show widget\n      if (widgetStorage) {\n        return false\n      }\n    }\n\n    if (widget.show_widget === consts.SHOW_WIDGET.RECURRENTLY) {\n      let show = false\n      if (widgetStorage.answered_at) {\n        // Check days of response is more than condition\n        let date = new Date(widgetStorage.answered_at)\n        date.setDate(date.getDate() + widget.days_after_response)\n        if (new Date().getTime() >= date.getTime()) {\n          show = true\n        }\n      }\n      if (widgetStorage.show_at && !widgetStorage.answered_at) {\n        // Check days of decline is more than condition\n        let date = new Date(widgetStorage.show_at)\n        date.setDate(date.getDate() + widget.days_after_decline)\n        if (new Date().getTime() >= date.getTime()) {\n          show = true\n        }\n      }\n      return show\n    }\n    return true\n  }\n  setShowAt() {\n    const widgetStorage = getStorage()\n    if (!widgetStorage) {\n      setStorage({ show_at: new Date().getTime() })\n    }\n  }\n  /**\n   * Set answered at in localStorage\n   */\n  setAnsweredAt() {\n    const widgetStorage = getStorage()\n    if (!widgetStorage) {\n      return\n    }\n    widgetStorage.answered_at = new Date().getTime()\n    setStorage(widgetStorage)\n  }\n  postOpenCounter() {\n    const widgetService = new WidgetService()\n    widgetService.postOpenCounter(store.state.widget.widget.public_hash)\n  }\n  /**\n   * Remove non question items from survey\n   * Like IMAGE and LABEL\n   */\n  removeNonQuestionItems(widget) {\n    if (widget.survey.jump_rules_enabled) {\n      return\n    }\n    widget.survey.items = widget.survey.items.filter(\n      item => item.type !== consts.QUESTION_TYPE.LABEL && item.type !== consts.QUESTION_TYPE.IMAGE,\n    )\n    return widget\n  }\n  setLanguage(widget) {\n    const userLang = getUserLanguage()\n    const lang = getSurveyLanguage(userLang, widget)\n    return lang\n  }\n  async postPartialAnswer(surveyPublicHash, answers) {\n    const widgetService = new WidgetService()\n    const response = await widgetService.postPartialAnswer(surveyPublicHash, answers)\n    this.setAnsweredAt()\n    return response\n  }\n  async postCompleteAnswer(surveyPublicHash, answers) {\n    const widgetService = new WidgetService()\n    const response = await widgetService.postCompleteAnswer(surveyPublicHash, answers)\n    this.setAnsweredAt()\n    return response\n  }\n\n  checkCustomerRecurrence(token, customer) {\n    const widgetService = new WidgetService()\n    const data = {\n      customer,\n    }\n    return widgetService.checkCustomerRecurrence(token, data)\n  }\n}\n"]}]}