{"remainingRequest":"/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js!/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue","mtime":1618575620742},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9ob21lL3RyYWNrL3dvcmtwbGFjZS9hMi9mcm9udGVuZC93aWRnZXQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICIvaG9tZS90cmFjay93b3JrcGxhY2UvYTIvZnJvbnRlbmQvd2lkZ2V0L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwovLwovLwovLwppbXBvcnQgeyBtYXBNdXRhdGlvbnMsIG1hcFN0YXRlIH0gZnJvbSAndnVleCc7CmltcG9ydCB1c2VJZnJhbWVDb250cm9sIGZyb20gJy4uLy4uL2hvb2tzL2lmcmFtZSc7CmltcG9ydCBCb3ggZnJvbSAnLi9jb21wb25lbnRzL0JveCc7CmltcG9ydCBXaWRnZXRVc2VDYXNlIGZyb20gJy4uLy4uL2FyY2gvd2lkZ2V0L3VzZWNhc2UnOwp2YXIgd2lkZ2V0VXNlQ2FzZSA9IG5ldyBXaWRnZXRVc2VDYXNlKCk7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBCb3g6IEJveAogIH0sCiAgcHJvcHM6IHsKICAgIGNvbmZpZzogT2JqZWN0CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgd2lkZ2V0OiBudWxsLAogICAgICBzaG93OiBmYWxzZQogICAgfTsKICB9LAogIGNvbXB1dGVkOiBfb2JqZWN0U3ByZWFkKHt9LCBtYXBTdGF0ZSh7CiAgICBjdXN0b21lcjogZnVuY3Rpb24gY3VzdG9tZXIoc3RhdGUpIHsKICAgICAgcmV0dXJuIHN0YXRlLnN1cnZleS5jdXN0b21lcjsKICAgIH0sCiAgICB0b2tlbjogZnVuY3Rpb24gdG9rZW4oc3RhdGUpIHsKICAgICAgcmV0dXJuIHN0YXRlLnN1cnZleS50b2tlbjsKICAgIH0KICB9KSksCiAgbWV0aG9kczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBtYXBNdXRhdGlvbnMoewogICAgc2V0VG9rZW46ICdzdXJ2ZXkvc2V0VG9rZW4nLAogICAgc2V0Q3VzdG9tZXI6ICdzdXJ2ZXkvc2V0Q3VzdG9tZXInCiAgfSkpLCB7fSwgewogICAgZ2V0V2lkZ2V0OiBmdW5jdGlvbiBnZXRXaWRnZXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB3aWRnZXRVc2VDYXNlLmdldE9uZShfdGhpcy50b2tlbik7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIF90aGlzLndpZGdldCA9IHJlc3BvbnNlOyAvL1JlbW92ZSBub24gcXVlc3Rpb24gaXRlbXMKCiAgICAgICAgICAgICAgICBfdGhpcy53aWRnZXQgPSB3aWRnZXRVc2VDYXNlLnJlbW92ZU5vblF1ZXN0aW9uSXRlbXMoX3RoaXMud2lkZ2V0KTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGdldElmcmFtZURhdGE6IGZ1bmN0aW9uIGdldElmcmFtZURhdGEoKSB7CiAgICAgIHZhciBpZnJhbWUgPSB1c2VJZnJhbWVDb250cm9sKCk7CiAgICAgIGlmcmFtZS51cGRhdGVEYXRhTGlzdGVuZXIoKTsKICAgICAgaWZyYW1lLmdldFRva2VuS2V5KCk7CiAgICB9LAogICAgZ2V0Q29uZmlnRGF0YTogZnVuY3Rpb24gZ2V0Q29uZmlnRGF0YSgpIHsKICAgICAgaWYgKHRoaXMuY29uZmlnKSB7CiAgICAgICAgdGhpcy5zZXRUb2tlbih0aGlzLmNvbmZpZy5rZXkpOwogICAgICAgIHRoaXMuc2V0Q3VzdG9tZXIodGhpcy5jb25maWcuY3VzdG9tZXIpOwogICAgICB9CiAgICB9LAogICAgc2hvd1dpZGdldEJ5VXNlcjogZnVuY3Rpb24gc2hvd1dpZGdldEJ5VXNlcigpIHsKICAgICAgcmV0dXJuIHdpZGdldFVzZUNhc2UuY2FuU2hvdyh0aGlzLndpZGdldCk7CiAgICB9LAogICAgc2V0dXA6IGZ1bmN0aW9uIHNldHVwKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBzaG93LCBkZWxheSwgdm07CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF90aGlzMi5nZXRJZnJhbWVEYXRhKCk7IC8vR2V0IGRhdGEgaW4gaWZyYW1lCgoKICAgICAgICAgICAgICAgIF90aGlzMi5nZXRDb25maWdEYXRhKCk7IC8vR2V0IGRhdGEgaW4gY2xhc3MgY29uZmlnIAoKCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLmdldFdpZGdldCgpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBzaG93ID0gX3RoaXMyLnNob3dXaWRnZXRCeVVzZXIoX3RoaXMyLndpZGdldCk7CgogICAgICAgICAgICAgICAgaWYgKHNob3cpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGRlbGF5ID0gX3RoaXMyLndpZGdldC5kZWxheSB8fCAwOwogICAgICAgICAgICAgICAgdm0gPSBfdGhpczI7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgLy8gc3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICAgICAgICAgICAgdm0uc2hvdyA9IHNob3c7CiAgICAgICAgICAgICAgICB9LCBkZWxheSAqIDEwMDApOwogICAgICAgICAgICAgICAgd2lkZ2V0VXNlQ2FzZS5zZXRTaG93QXQoKTsKICAgICAgICAgICAgICAgIHdpZGdldFVzZUNhc2UucG9zdE9wZW5Db3VudGVyKCk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICB9KSkoKTsKICAgIH0KICB9KSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy5zZXR1cCgpOwogIH0KfTs="},{"version":3,"sources":["Widget.vue"],"names":[],"mappings":";;;;;;AAIA,SAAA,YAAA,EAAA,QAAA,QAAA,MAAA;AACA,OAAA,gBAAA,MAAA,oBAAA;AACA,OAAA,GAAA,MAAA,kBAAA;AAEA,OAAA,aAAA,MAAA,2BAAA;AACA,IAAA,aAAA,GAAA,IAAA,aAAA,EAAA;AAEA,eAAA;AACA,EAAA,UAAA,EAAA;AAAA,IAAA,GAAA,EAAA;AAAA,GADA;AAEA,EAAA,KAAA,EAAA;AACA,IAAA,MAAA,EAAA;AADA,GAFA;AAKA,EAAA,IALA,kBAKA;AACA,WAAA;AACA,MAAA,MAAA,EAAA,IADA;AAEA,MAAA,IAAA,EAAA;AAFA,KAAA;AAIA,GAVA;AAWA,EAAA,QAAA,oBACA,QAAA,CAAA;AACA,IAAA,QAAA,EAAA,kBAAA,KAAA;AAAA,aAAA,KAAA,CAAA,MAAA,CAAA,QAAA;AAAA,KADA;AAEA,IAAA,KAAA,EAAA,eAAA,KAAA;AAAA,aAAA,KAAA,CAAA,MAAA,CAAA,KAAA;AAAA;AAFA,GAAA,CADA,CAXA;AAiBA,EAAA,OAAA,kCACA,YAAA,CAAA;AACA,IAAA,QAAA,EAAA,iBADA;AAEA,IAAA,WAAA,EAAA;AAFA,GAAA,CADA;AAKA,IAAA,SALA,uBAKA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACA,aAAA,CAAA,MAAA,CAAA,KAAA,CAAA,KAAA,CADA;;AAAA;AACA,gBAAA,QADA;AAEA,gBAAA,KAAA,CAAA,MAAA,GAAA,QAAA,CAFA,CAIA;;AACA,gBAAA,KAAA,CAAA,MAAA,GAAA,aAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,MAAA,CAAA;;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA,KAXA;AAYA,IAAA,aAZA,2BAYA;AACA,UAAA,MAAA,GAAA,gBAAA,EAAA;AACA,MAAA,MAAA,CAAA,kBAAA;AACA,MAAA,MAAA,CAAA,WAAA;AACA,KAhBA;AAiBA,IAAA,aAjBA,2BAiBA;AACA,UAAA,KAAA,MAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,MAAA,CAAA,GAAA;AACA,aAAA,WAAA,CAAA,KAAA,MAAA,CAAA,QAAA;AACA;AACA,KAtBA;AAuBA,IAAA,gBAvBA,8BAuBA;AACA,aAAA,aAAA,CAAA,OAAA,CAAA,KAAA,MAAA,CAAA;AACA,KAzBA;AA0BA,IAAA,KA1BA,mBA0BA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,gBAAA,MAAA,CAAA,aAAA,GADA,CACA;;;AACA,gBAAA,MAAA,CAAA,aAAA,GAFA,CAEA;;;AAFA;AAAA,uBAGA,MAAA,CAAA,SAAA,EAHA;;AAAA;AAIA,gBAAA,IAJA,GAIA,MAAA,CAAA,gBAAA,CAAA,MAAA,CAAA,MAAA,CAJA;;AAAA,oBAKA,IALA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AASA,gBAAA,KATA,GASA,MAAA,CAAA,MAAA,CAAA,KAAA,IAAA,CATA;AAUA,gBAAA,EAVA,GAUA,MAVA;AAWA,gBAAA,UAAA,CAAA,YAAA;AACA;AACA,kBAAA,EAAA,CAAA,IAAA,GAAA,IAAA;AACA,iBAHA,EAGA,KAAA,GAAA,IAHA,CAAA;AAKA,gBAAA,aAAA,CAAA,SAAA;AACA,gBAAA,aAAA,CAAA,eAAA;;AAjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkBA;AA5CA,IAjBA;AA+DA,EAAA,OA/DA,qBA+DA;AACA,SAAA,KAAA;AACA;AAjEA,CAAA","sourcesContent":["<template>\n  <Box :widget=\"widget\" v-if=\"widget && show\" />\n</template>\n<script>\nimport { mapMutations, mapState } from 'vuex'\nimport useIframeControl from '../../hooks/iframe'\nimport Box from './components/Box'\n\nimport WidgetUseCase from '../../arch/widget/usecase'\nconst widgetUseCase = new WidgetUseCase()\n\nexport default {\n  components: { Box },\n  props: {\n    config: Object\n  },\n  data () {\n    return {\n      widget: null,\n      show: false\n    }\n  },\n  computed: {\n    ...mapState({\n      customer: state => state.survey.customer,\n      token: state => state.survey.token\n    })\n  },\n  methods: {\n    ...mapMutations({\n      setToken: 'survey/setToken',\n      setCustomer: 'survey/setCustomer'\n    }),\n    async getWidget () {\n      const response = await widgetUseCase.getOne(this.token)\n      this.widget = response\n\n      //Remove non question items\n      this.widget = widgetUseCase.removeNonQuestionItems(this.widget)\n    },\n    getIframeData () {\n      const iframe = useIframeControl()\n      iframe.updateDataListener()\n      iframe.getTokenKey()\n    },\n    getConfigData () {\n      if (this.config) {\n        this.setToken(this.config.key)\n        this.setCustomer(this.config.customer)\n      }\n    },\n    showWidgetByUser () {\n      return widgetUseCase.canShow(this.widget)\n    },\n    async setup () {\n      this.getIframeData() //Get data in iframe\n      this.getConfigData() //Get data in class config \n      await this.getWidget()\n      const show = this.showWidgetByUser(this.widget)\n      if (!show) {\n        return\n      }\n\n      const delay = this.widget.delay || 0\n      const vm = this\n      setTimeout(() => {\n        // startTime = new Date().getTime()\n        vm.show = show\n      }, delay * 1000)\n\n      widgetUseCase.setShowAt()\n      widgetUseCase.postOpenCounter()\n    }\n  },\n  created () {\n    this.setup()\n  }\n}\n</script>\n"],"sourceRoot":"src/views/Widget"}]}