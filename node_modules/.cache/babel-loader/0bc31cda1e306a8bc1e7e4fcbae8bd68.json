{"remainingRequest":"/home/track/workplace/widget-iframe/node_modules/babel-loader/lib/index.js!/home/track/workplace/widget-iframe/node_modules/eslint-loader/index.js??ref--13-0!/home/track/workplace/widget-iframe/src/hooks/storage.js","dependencies":[{"path":"/home/track/workplace/widget-iframe/src/hooks/storage.js","mtime":1629149202320},{"path":"/home/track/workplace/widget-iframe/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/widget-iframe/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/widget-iframe/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHN0b3JlIGZyb20gIi4uL3N0b3JlIjsKaW1wb3J0IHsgUkVDVVJSRU5DRV9USU1FLCBSRUFDVElWQVRJT05fVElNRSB9IGZyb20gIi4uL2NvbnN0cy90aW1lIjsKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdXNlU3RvcmFnZUNvbnRyb2woKSB7CiAgZnVuY3Rpb24gY2FuU2hvdygpIHsKICAgIHZhciB3aWRnZXRTdG9yYWdlID0gZ2V0U3RvcmFnZSgpOwoKICAgIGlmICghd2lkZ2V0U3RvcmFnZSkgewogICAgICAvLyBEb250IGhhdmUgc3RvcmFnZSBzZXR0ZWQsIHNob3cgd2lkZ2V0CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHZhciBzaG93ID0gdHJ1ZTsKCiAgICBpZiAod2lkZ2V0U3RvcmFnZS5hbnN3ZXJlZF9hdCkgewogICAgICAvLyBDaGVjayBkYXlzIG9mIHJlc3BvbnNlIGlzIG1vcmUgdGhhbiBjb25kaXRpb24KICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh3aWRnZXRTdG9yYWdlLmFuc3dlcmVkX2F0KTsKICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgUkVDVVJSRU5DRV9USU1FKTsKCiAgICAgIGlmIChuZXcgRGF0ZSgpLmdldFRpbWUoKSA8IGRhdGUuZ2V0VGltZSgpKSB7CiAgICAgICAgc2hvdyA9IGZhbHNlOwogICAgICB9CiAgICB9CgogICAgaWYgKHdpZGdldFN0b3JhZ2UuZGVjbGluZV9hdCkgewogICAgICAvLyBDaGVjayBkYXlzIG9mIGRlY2xpbmUgaXMgbW9yZSB0aGFuIGNvbmRpdGlvbgogICAgICB2YXIgX2RhdGUgPSBuZXcgRGF0ZSh3aWRnZXRTdG9yYWdlLmRlY2xpbmVfYXQpOwoKICAgICAgX2RhdGUuc2V0RGF0ZShfZGF0ZS5nZXREYXRlKCkgKyBSRUFDVElWQVRJT05fVElNRSk7CgogICAgICBpZiAobmV3IERhdGUoKS5nZXRUaW1lKCkgPCBfZGF0ZS5nZXRUaW1lKCkpIHsKICAgICAgICBzaG93ID0gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc2hvdzsKICB9CgogIGZ1bmN0aW9uIHNldFNob3dBdCgpIHsKICAgIHZhciB3aWRnZXRTdG9yYWdlID0gZ2V0U3RvcmFnZSgpOwoKICAgIGlmICghd2lkZ2V0U3RvcmFnZSkgewogICAgICBzZXRTdG9yYWdlKHsKICAgICAgICBzaG93X2F0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKQogICAgICB9KTsKICAgIH0KICB9CiAgLyoqCiAgICogU2V0IGFuc3dlcmVkIGF0IGluIGxvY2FsU3RvcmFnZQogICAqLwoKCiAgZnVuY3Rpb24gc2V0QW5zd2VyZWRBdCgpIHsKICAgIHZhciB3aWRnZXRTdG9yYWdlID0gZ2V0U3RvcmFnZSgpOwoKICAgIGlmICghd2lkZ2V0U3RvcmFnZSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgd2lkZ2V0U3RvcmFnZS5hbnN3ZXJlZF9hdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgc2V0U3RvcmFnZSh3aWRnZXRTdG9yYWdlKTsKICB9CgogIHJldHVybiB7CiAgICBjYW5TaG93OiBjYW5TaG93LAogICAgc2V0U2hvd0F0OiBzZXRTaG93QXQsCiAgICBzZXRBbnN3ZXJlZEF0OiBzZXRBbnN3ZXJlZEF0CiAgfTsKfQovKioKICogU2V0IHdpZGdldFN0b3JhZ2UgaW4gbG9jYWxTdG9yYWdlCiAqIHNob3dfYXQgPSB0aW1lc3RhbXAgdGhhdCB3aWRnZXQgd2FzIHZpZXcgYnkgdXNlcgogKiBhbnN3ZXJlZF9hdCA9IHRpbWVzdGFtcCB0aGF0IHVzZXIgYW5zd2VyIHRoZSB3aWRnZXQKICogQHBhcmFtIHt3aWRnZXRTdG9yYWdlfSB3aWRnZXRTdG9yYWdlCiAqLwoKdmFyIHNldFN0b3JhZ2UgPSBmdW5jdGlvbiBzZXRTdG9yYWdlKHdpZGdldFN0b3JhZ2UpIHsKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yZS5zdGF0ZS53aWRnZXQudG9rZW4sIEpTT04uc3RyaW5naWZ5KHdpZGdldFN0b3JhZ2UpKTsKfTsKLyoqCiAqIEdldCB3aWRnZXRTdG9yYWdlIGluIGxvY2FsU3RvcmFnZQogKi8KCgp2YXIgZ2V0U3RvcmFnZSA9IGZ1bmN0aW9uIGdldFN0b3JhZ2UoKSB7CiAgdmFyIHdpZGdldFN0b3JhZ2UgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JlLnN0YXRlLndpZGdldC50b2tlbikpOwogIHJldHVybiB3aWRnZXRTdG9yYWdlOwp9Ow=="},{"version":3,"sources":["/home/track/workplace/widget-iframe/src/hooks/storage.js"],"names":["store","RECURRENCE_TIME","REACTIVATION_TIME","useStorageControl","canShow","widgetStorage","getStorage","show","answered_at","date","Date","setDate","getDate","getTime","decline_at","setShowAt","setStorage","show_at","setAnsweredAt","localStorage","setItem","state","widget","token","JSON","stringify","parse","getItem"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,UAAlB;AACA,SAASC,eAAT,EAA0BC,iBAA1B,QAAmD,gBAAnD;AAEA,eAAe,SAASC,iBAAT,GAA6B;AAC1C,WAASC,OAAT,GAAmB;AACjB,QAAMC,aAAa,GAAGC,UAAU,EAAhC;;AACA,QAAI,CAACD,aAAL,EAAoB;AAClB;AACA,aAAO,IAAP;AACD;;AAED,QAAIE,IAAI,GAAG,IAAX;;AACA,QAAIF,aAAa,CAACG,WAAlB,EAA+B;AAC7B;AACA,UAAIC,IAAI,GAAG,IAAIC,IAAJ,CAASL,aAAa,CAACG,WAAvB,CAAX;AACAC,MAAAA,IAAI,CAACE,OAAL,CAAaF,IAAI,CAACG,OAAL,KAAiBX,eAA9B;;AACA,UAAI,IAAIS,IAAJ,GAAWG,OAAX,KAAuBJ,IAAI,CAACI,OAAL,EAA3B,EAA2C;AACzCN,QAAAA,IAAI,GAAG,KAAP;AACD;AACF;;AACD,QAAIF,aAAa,CAACS,UAAlB,EAA8B;AAC5B;AACA,UAAIL,KAAI,GAAG,IAAIC,IAAJ,CAASL,aAAa,CAACS,UAAvB,CAAX;;AACAL,MAAAA,KAAI,CAACE,OAAL,CAAaF,KAAI,CAACG,OAAL,KAAiBV,iBAA9B;;AACA,UAAI,IAAIQ,IAAJ,GAAWG,OAAX,KAAuBJ,KAAI,CAACI,OAAL,EAA3B,EAA2C;AACzCN,QAAAA,IAAI,GAAG,KAAP;AACD;AACF;;AAED,WAAOA,IAAP;AACD;;AAED,WAASQ,SAAT,GAAqB;AACnB,QAAMV,aAAa,GAAGC,UAAU,EAAhC;;AACA,QAAI,CAACD,aAAL,EAAoB;AAClBW,MAAAA,UAAU,CAAC;AAAEC,QAAAA,OAAO,EAAE,IAAIP,IAAJ,GAAWG,OAAX;AAAX,OAAD,CAAV;AACD;AACF;AAED;AACF;AACA;;;AACE,WAASK,aAAT,GAAyB;AACvB,QAAMb,aAAa,GAAGC,UAAU,EAAhC;;AACA,QAAI,CAACD,aAAL,EAAoB;AAClB;AACD;;AACDA,IAAAA,aAAa,CAACG,WAAd,GAA4B,IAAIE,IAAJ,GAAWG,OAAX,EAA5B;AACAG,IAAAA,UAAU,CAACX,aAAD,CAAV;AACD;;AAED,SAAO;AACLD,IAAAA,OAAO,EAAPA,OADK;AAELW,IAAAA,SAAS,EAATA,SAFK;AAGLG,IAAAA,aAAa,EAAbA;AAHK,GAAP;AAKD;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMF,UAAU,GAAG,SAAbA,UAAa,CAACX,aAAD,EAAmB;AACpCc,EAAAA,YAAY,CAACC,OAAb,CAAqBpB,KAAK,CAACqB,KAAN,CAAYC,MAAZ,CAAmBC,KAAxC,EAA+CC,IAAI,CAACC,SAAL,CAAepB,aAAf,CAA/C;AACD,CAFD;AAGA;AACA;AACA;;;AACA,IAAMC,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvB,MAAMD,aAAa,GAAGmB,IAAI,CAACE,KAAL,CAAWP,YAAY,CAACQ,OAAb,CAAqB3B,KAAK,CAACqB,KAAN,CAAYC,MAAZ,CAAmBC,KAAxC,CAAX,CAAtB;AACA,SAAOlB,aAAP;AACD,CAHD","sourcesContent":["import store from \"../store\";\nimport { RECURRENCE_TIME, REACTIVATION_TIME } from \"../consts/time\";\n\nexport default function useStorageControl() {\n  function canShow() {\n    const widgetStorage = getStorage();\n    if (!widgetStorage) {\n      // Dont have storage setted, show widget\n      return true;\n    }\n\n    let show = true;\n    if (widgetStorage.answered_at) {\n      // Check days of response is more than condition\n      let date = new Date(widgetStorage.answered_at);\n      date.setDate(date.getDate() + RECURRENCE_TIME);\n      if (new Date().getTime() < date.getTime()) {\n        show = false;\n      }\n    }\n    if (widgetStorage.decline_at) {\n      // Check days of decline is more than condition\n      let date = new Date(widgetStorage.decline_at);\n      date.setDate(date.getDate() + REACTIVATION_TIME);\n      if (new Date().getTime() < date.getTime()) {\n        show = false;\n      }\n    }\n\n    return show;\n  }\n\n  function setShowAt() {\n    const widgetStorage = getStorage();\n    if (!widgetStorage) {\n      setStorage({ show_at: new Date().getTime() });\n    }\n  }\n\n  /**\n   * Set answered at in localStorage\n   */\n  function setAnsweredAt() {\n    const widgetStorage = getStorage();\n    if (!widgetStorage) {\n      return;\n    }\n    widgetStorage.answered_at = new Date().getTime();\n    setStorage(widgetStorage);\n  }\n\n  return {\n    canShow,\n    setShowAt,\n    setAnsweredAt\n  };\n}\n\n/**\n * Set widgetStorage in localStorage\n * show_at = timestamp that widget was view by user\n * answered_at = timestamp that user answer the widget\n * @param {widgetStorage} widgetStorage\n */\nconst setStorage = (widgetStorage) => {\n  localStorage.setItem(store.state.widget.token, JSON.stringify(widgetStorage));\n};\n/**\n * Get widgetStorage in localStorage\n */\nconst getStorage = () => {\n  const widgetStorage = JSON.parse(localStorage.getItem(store.state.widget.token));\n  return widgetStorage;\n};\n"]}]}