{"remainingRequest":"/home/track/workplace/a2/frontend/widget/node_modules/thread-loader/dist/cjs.js!/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js!/home/track/workplace/a2/frontend/widget/node_modules/eslint-loader/index.js??ref--13-0!/home/track/workplace/a2/frontend/widget/src/arch/widget/usecase.js","dependencies":[{"path":"/home/track/workplace/a2/frontend/widget/src/arch/widget/usecase.js","mtime":1618594205530},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9ob21lL3RyYWNrL3dvcmtwbGFjZS9hMi9mcm9udGVuZC93aWRnZXQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9ob21lL3RyYWNrL3dvcmtwbGFjZS9hMi9mcm9udGVuZC93aWRnZXQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvaG9tZS90cmFjay93b3JrcGxhY2UvYTIvZnJvbnRlbmQvd2lkZ2V0L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0IFdpZGdldFNlcnZpY2UgZnJvbSAnLi9zZXJ2aWNlJzsKaW1wb3J0IGNvbnN0cyBmcm9tICcuLi8uLi9jb25zdHMnOwppbXBvcnQgc3RvcmUgZnJvbSAnLi4vLi4vc3RvcmUnOwppbXBvcnQgeyBnZXRVc2VyTGFuZ3VhZ2UsIGdldFN1cnZleUxhbmd1YWdlIH0gZnJvbSAnLi4vLi4vdXRpbHMvbGFuZ3VhZ2UnOwovKioKICogU2V0IHdpZGdldFN0b3JhZ2UgaW4gbG9jYWxTdG9yYWdlCiAqIHNob3dfYXQgPSB0aW1lc3RhbXAgdGhhdCB3aWRnZXQgd2FzIHZpZXcgYnkgdXNlcgogKiBhbnN3ZXJlZF9hdCA9IHRpbWVzdGFtcCB0aGF0IHVzZXIgYW5zd2VyIHRoZSB3aWRnZXQKICogQHBhcmFtIHt3aWRnZXRTdG9yYWdlfSB3aWRnZXRTdG9yYWdlCiAqLwoKdmFyIHNldFN0b3JhZ2UgPSBmdW5jdGlvbiBzZXRTdG9yYWdlKHdpZGdldFN0b3JhZ2UpIHsKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShzdG9yZS5zdGF0ZS5zdXJ2ZXkudG9rZW4sIEpTT04uc3RyaW5naWZ5KHdpZGdldFN0b3JhZ2UpKTsKfTsKLyoqCiAqIEdldCB3aWRnZXRTdG9yYWdlIGluIGxvY2FsU3RvcmFnZQogKi8KCgp2YXIgZ2V0U3RvcmFnZSA9IGZ1bmN0aW9uIGdldFN0b3JhZ2UoKSB7CiAgdmFyIHdpZGdldFN0b3JhZ2UgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JlLnN0YXRlLnN1cnZleS50b2tlbikpOwogIHJldHVybiB3aWRnZXRTdG9yYWdlOwp9OwoKdmFyIFdpZGdldFVzZUNhc2UgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFdpZGdldFVzZUNhc2UoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV2lkZ2V0VXNlQ2FzZSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoV2lkZ2V0VXNlQ2FzZSwgW3sKICAgIGtleTogImdldE9uZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T25lKHRva2VuKSB7CiAgICAgIHZhciB3aWRnZXRTZXJ2aWNlID0gbmV3IFdpZGdldFNlcnZpY2UoKTsKICAgICAgcmV0dXJuIHdpZGdldFNlcnZpY2UuZ2V0T25lKHRva2VuKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjYW5TaG93IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjYW5TaG93KHdpZGdldCkgewogICAgICB2YXIgd2lkZ2V0U3RvcmFnZSA9IGdldFN0b3JhZ2UoKTsKCiAgICAgIGlmICghd2lkZ2V0U3RvcmFnZSkgewogICAgICAgIC8vIERvbnQgaGF2ZSBzdG9yYWdlIHNldHRlZCwgc2hvdyB3aWRnZXQKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHdpZGdldC5zaG93X3dpZGdldCA9PT0gY29uc3RzLlNIT1dfV0lER0VULk9OQ0UpIHsKICAgICAgICAvLyBJZiBoYXZlIHN0b3JhZ2UgYW5kIGlzIHNldHRlZCwgZG9uJ3Qgc2hvdyB3aWRnZXQKICAgICAgICBpZiAod2lkZ2V0U3RvcmFnZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHdpZGdldC5zaG93X3dpZGdldCA9PT0gY29uc3RzLlNIT1dfV0lER0VULlJFQ1VSUkVOVExZKSB7CiAgICAgICAgdmFyIHNob3cgPSBmYWxzZTsKCiAgICAgICAgaWYgKHdpZGdldFN0b3JhZ2UuYW5zd2VyZWRfYXQpIHsKICAgICAgICAgIC8vIENoZWNrIGRheXMgb2YgcmVzcG9uc2UgaXMgbW9yZSB0aGFuIGNvbmRpdGlvbgogICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh3aWRnZXRTdG9yYWdlLmFuc3dlcmVkX2F0KTsKICAgICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIHdpZGdldC5kYXlzX2FmdGVyX3Jlc3BvbnNlKTsKCiAgICAgICAgICBpZiAobmV3IERhdGUoKS5nZXRUaW1lKCkgPj0gZGF0ZS5nZXRUaW1lKCkpIHsKICAgICAgICAgICAgc2hvdyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAod2lkZ2V0U3RvcmFnZS5zaG93X2F0ICYmICF3aWRnZXRTdG9yYWdlLmFuc3dlcmVkX2F0KSB7CiAgICAgICAgICAvLyBDaGVjayBkYXlzIG9mIGRlY2xpbmUgaXMgbW9yZSB0aGFuIGNvbmRpdGlvbgogICAgICAgICAgdmFyIF9kYXRlID0gbmV3IERhdGUod2lkZ2V0U3RvcmFnZS5zaG93X2F0KTsKCiAgICAgICAgICBfZGF0ZS5zZXREYXRlKF9kYXRlLmdldERhdGUoKSArIHdpZGdldC5kYXlzX2FmdGVyX2RlY2xpbmUpOwoKICAgICAgICAgIGlmIChuZXcgRGF0ZSgpLmdldFRpbWUoKSA+PSBfZGF0ZS5nZXRUaW1lKCkpIHsKICAgICAgICAgICAgc2hvdyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2hvdzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0U2hvd0F0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTaG93QXQoKSB7CiAgICAgIHZhciB3aWRnZXRTdG9yYWdlID0gZ2V0U3RvcmFnZSgpOwoKICAgICAgaWYgKCF3aWRnZXRTdG9yYWdlKSB7CiAgICAgICAgc2V0U3RvcmFnZSh7CiAgICAgICAgICBzaG93X2F0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbnN3ZXJlZCBhdCBpbiBsb2NhbFN0b3JhZ2UKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXRBbnN3ZXJlZEF0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRBbnN3ZXJlZEF0KCkgewogICAgICB2YXIgd2lkZ2V0U3RvcmFnZSA9IGdldFN0b3JhZ2UoKTsKCiAgICAgIGlmICghd2lkZ2V0U3RvcmFnZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgd2lkZ2V0U3RvcmFnZS5hbnN3ZXJlZF9hdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICBzZXRTdG9yYWdlKHdpZGdldFN0b3JhZ2UpOwogICAgfQogIH0sIHsKICAgIGtleTogInBvc3RPcGVuQ291bnRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcG9zdE9wZW5Db3VudGVyKCkgewogICAgICB2YXIgd2lkZ2V0U2VydmljZSA9IG5ldyBXaWRnZXRTZXJ2aWNlKCk7CiAgICAgIHdpZGdldFNlcnZpY2UucG9zdE9wZW5Db3VudGVyKHN0b3JlLnN0YXRlLnN1cnZleS50b2tlbik7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBub24gcXVlc3Rpb24gaXRlbXMgZnJvbSBzdXJ2ZXkKICAgICAqIExpa2UgSU1BR0UgYW5kIExBQkVMCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlTm9uUXVlc3Rpb25JdGVtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlTm9uUXVlc3Rpb25JdGVtcyh3aWRnZXQpIHsKICAgICAgaWYgKHdpZGdldC5zdXJ2ZXkuanVtcF9ydWxlc19lbmFibGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB3aWRnZXQuc3VydmV5Lml0ZW1zID0gd2lkZ2V0LnN1cnZleS5pdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS50eXBlICE9PSBjb25zdHMuUVVFU1RJT05fVFlQRS5MQUJFTCAmJiBpdGVtLnR5cGUgIT09IGNvbnN0cy5RVUVTVElPTl9UWVBFLklNQUdFOwogICAgICB9KTsKICAgICAgcmV0dXJuIHdpZGdldDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRMYW5ndWFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TGFuZ3VhZ2Uod2lkZ2V0KSB7CiAgICAgIHZhciB1c2VyTGFuZyA9IGdldFVzZXJMYW5ndWFnZSgpOwogICAgICB2YXIgbGFuZyA9IGdldFN1cnZleUxhbmd1YWdlKHVzZXJMYW5nLCB3aWRnZXQpOwogICAgICBzdG9yZS5jb21taXQoJ3N1cnZleS9zZXRMYW5ndWFnZScsIGxhbmcpOwogICAgfQogIH0sIHsKICAgIGtleTogInBvc3RQYXJ0aWFsQW5zd2VyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdFBhcnRpYWxBbnN3ZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoc3VydmV5UHVibGljSGFzaCwgYW5zd2VycykgewogICAgICAgIHZhciB3aWRnZXRTZXJ2aWNlLCByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB3aWRnZXRTZXJ2aWNlID0gbmV3IFdpZGdldFNlcnZpY2UoKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHdpZGdldFNlcnZpY2UucG9zdFBhcnRpYWxBbnN3ZXIoc3VydmV5UHVibGljSGFzaCwgYW5zd2Vycyk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5zd2VyZWRBdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdFBhcnRpYWxBbnN3ZXIoX3gsIF94MikgewogICAgICAgIHJldHVybiBfcG9zdFBhcnRpYWxBbnN3ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RQYXJ0aWFsQW5zd2VyOwogICAgfSgpCiAgfSwgewogICAga2V5OiAicG9zdENvbXBsZXRlQW5zd2VyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdENvbXBsZXRlQW5zd2VyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihzdXJ2ZXlQdWJsaWNIYXNoLCBhbnN3ZXJzKSB7CiAgICAgICAgdmFyIHdpZGdldFNlcnZpY2UsIHJlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB3aWRnZXRTZXJ2aWNlID0gbmV3IFdpZGdldFNlcnZpY2UoKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB3aWRnZXRTZXJ2aWNlLnBvc3RDb21wbGV0ZUFuc3dlcihzdXJ2ZXlQdWJsaWNIYXNoLCBhbnN3ZXJzKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHRoaXMuc2V0QW5zd2VyZWRBdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdENvbXBsZXRlQW5zd2VyKF94MywgX3g0KSB7CiAgICAgICAgcmV0dXJuIF9wb3N0Q29tcGxldGVBbnN3ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RDb21wbGV0ZUFuc3dlcjsKICAgIH0oKQogIH1dKTsKCiAgcmV0dXJuIFdpZGdldFVzZUNhc2U7Cn0oKTsKCmV4cG9ydCB7IFdpZGdldFVzZUNhc2UgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["/home/track/workplace/a2/frontend/widget/src/arch/widget/usecase.js"],"names":["WidgetService","consts","store","getUserLanguage","getSurveyLanguage","setStorage","widgetStorage","localStorage","setItem","state","survey","token","JSON","stringify","getStorage","parse","getItem","WidgetUseCase","widgetService","getOne","widget","show_widget","SHOW_WIDGET","ONCE","RECURRENTLY","show","answered_at","date","Date","setDate","getDate","days_after_response","getTime","show_at","days_after_decline","postOpenCounter","jump_rules_enabled","items","filter","item","type","QUESTION_TYPE","LABEL","IMAGE","userLang","lang","commit","surveyPublicHash","answers","postPartialAnswer","response","setAnsweredAt","postCompleteAnswer"],"mappings":"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","sourcesContent":["import WidgetService from './service'\nimport consts from '../../consts'\nimport store from '../../store'\nimport { getUserLanguage, getSurveyLanguage } from '../../utils/language'\n\n\n/**\n * Set widgetStorage in localStorage\n * show_at = timestamp that widget was view by user\n * answered_at = timestamp that user answer the widget\n * @param {widgetStorage} widgetStorage\n */\nconst setStorage = (widgetStorage) => {\n    localStorage.setItem(store.state.survey.token, JSON.stringify(widgetStorage))\n}\n/**\n * Get widgetStorage in localStorage\n */\nconst getStorage = () => {\n    const widgetStorage = JSON.parse(localStorage.getItem(store.state.survey.token))\n    return widgetStorage\n}\n\nexport default class WidgetUseCase {\n    getOne (token) {\n        const widgetService = new WidgetService()\n        return widgetService.getOne(token)\n    }\n    canShow (widget) {\n        const widgetStorage = getStorage()\n        if (!widgetStorage) {\n            // Dont have storage setted, show widget\n            return true\n        }\n\n        if (widget.show_widget === consts.SHOW_WIDGET.ONCE) {\n            // If have storage and is setted, don't show widget\n            if (widgetStorage) {\n                return false\n            }\n        }\n\n        if (widget.show_widget === consts.SHOW_WIDGET.RECURRENTLY) {\n            let show = false\n            if (widgetStorage.answered_at) {\n                // Check days of response is more than condition\n                let date = new Date(widgetStorage.answered_at)\n                date.setDate(date.getDate() + widget.days_after_response)\n                if (new Date().getTime() >= date.getTime()) {\n                    show = true\n                }\n            }\n            if (widgetStorage.show_at && !widgetStorage.answered_at) {\n                // Check days of decline is more than condition\n                let date = new Date(widgetStorage.show_at)\n                date.setDate(date.getDate() + widget.days_after_decline)\n                if (new Date().getTime() >= date.getTime()) {\n                    show = true\n                }\n            }\n            return show\n        }\n        return true\n    }\n    setShowAt () {\n        const widgetStorage = getStorage()\n        if (!widgetStorage) {\n            setStorage({ show_at: new Date().getTime() })\n        }\n    }\n    /**\n     * Set answered at in localStorage\n     */\n    setAnsweredAt () {\n        const widgetStorage = getStorage()\n        if (!widgetStorage) {\n            return\n        }\n        widgetStorage.answered_at = new Date().getTime()\n        setStorage(widgetStorage)\n    }\n    postOpenCounter () {\n        const widgetService = new WidgetService()\n        widgetService.postOpenCounter(store.state.survey.token)\n    }\n    /**\n     * Remove non question items from survey\n     * Like IMAGE and LABEL\n     */\n    removeNonQuestionItems (widget) {\n        if (widget.survey.jump_rules_enabled) {\n            return\n        }\n        widget.survey.items = widget.survey.items.filter(item => item.type !== consts.QUESTION_TYPE.LABEL && item.type !== consts.QUESTION_TYPE.IMAGE)\n        return widget\n    }\n    setLanguage (widget) {\n        const userLang = getUserLanguage()\n        const lang = getSurveyLanguage(userLang, widget)\n        store.commit('survey/setLanguage', lang)\n    }\n    async postPartialAnswer (surveyPublicHash, answers) {\n        const widgetService = new WidgetService()\n        const response = await widgetService.postPartialAnswer(surveyPublicHash, answers)\n        this.setAnsweredAt()\n        return response\n    }\n    async postCompleteAnswer (surveyPublicHash, answers) {\n        const widgetService = new WidgetService()\n        const response = await widgetService.postCompleteAnswer(surveyPublicHash, answers)\n        this.setAnsweredAt()\n        return response\n    }\n}"]}]}