{"remainingRequest":"/home/track/workplace/a2/frontend/widget/node_modules/thread-loader/dist/cjs.js!/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js!/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/track/workplace/a2/frontend/widget/src/views/Widget/Widget.vue","mtime":1618838317897},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/track/workplace/a2/frontend/widget/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9ob21lL3RyYWNrL3dvcmtwbGFjZS9hMi9mcm9udGVuZC93aWRnZXQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICIvaG9tZS90cmFjay93b3JrcGxhY2UvYTIvZnJvbnRlbmQvd2lkZ2V0L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wcm9taXNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7Ci8vCi8vCi8vCmltcG9ydCB7IG1hcE11dGF0aW9ucywgbWFwU3RhdGUgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHVzZUlmcmFtZUNvbnRyb2wgZnJvbSAnLi4vLi4vaG9va3MvaWZyYW1lJzsKaW1wb3J0IFdpZGdldFVzZUNhc2UgZnJvbSAnLi4vLi4vYXJjaC93aWRnZXQvdXNlY2FzZSc7CnZhciB3aWRnZXRVc2VDYXNlID0gbmV3IFdpZGdldFVzZUNhc2UoKTsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIEJveDogZnVuY3Rpb24gQm94KCkgewogICAgICByZXR1cm4gaW1wb3J0KCcuL0JveCcpOwogICAgfQogIH0sCiAgcHJvcHM6IHsKICAgIGNvbmZpZzogT2JqZWN0CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgd2lkZ2V0OiBudWxsCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IF9vYmplY3RTcHJlYWQoe30sIG1hcFN0YXRlKHsKICAgIGN1c3RvbWVyOiBmdW5jdGlvbiBjdXN0b21lcihzdGF0ZSkgewogICAgICByZXR1cm4gc3RhdGUuc3VydmV5LmN1c3RvbWVyOwogICAgfSwKICAgIHRva2VuOiBmdW5jdGlvbiB0b2tlbihzdGF0ZSkgewogICAgICByZXR1cm4gc3RhdGUuc3VydmV5LnRva2VuOwogICAgfSwKICAgIHNob3c6IGZ1bmN0aW9uIHNob3coc3RhdGUpIHsKICAgICAgcmV0dXJuIHN0YXRlLnN1cnZleS5zaG93OwogICAgfQogIH0pKSwKICBtZXRob2RzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcE11dGF0aW9ucyh7CiAgICBzZXRUb2tlbjogJ3N1cnZleS9zZXRUb2tlbicsCiAgICBzZXRDdXN0b21lcjogJ3N1cnZleS9zZXRDdXN0b21lcicsCiAgICBzaG93V2lkZ2V0OiAnc3VydmV5L3Nob3dXaWRnZXQnLAogICAgc2V0RWRpdE1vZGU6ICdzdXJ2ZXkvc2V0RWRpdE1vZGUnCiAgfSkpLCB7fSwgewogICAgZ2V0V2lkZ2V0OiBmdW5jdGlvbiBnZXRXaWRnZXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB3aWRnZXRVc2VDYXNlLmdldE9uZShfdGhpcy50b2tlbik7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIF90aGlzLndpZGdldCA9IHJlc3BvbnNlOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpcy53aWRnZXQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAvL1JlbW92ZSBub24gcXVlc3Rpb24gaXRlbXMKICAgICAgICAgICAgICAgIF90aGlzLndpZGdldCA9IHdpZGdldFVzZUNhc2UucmVtb3ZlTm9uUXVlc3Rpb25JdGVtcyhfdGhpcy53aWRnZXQpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZ2V0SWZyYW1lRGF0YTogZnVuY3Rpb24gZ2V0SWZyYW1lRGF0YSgpIHsKICAgICAgdmFyIGlmcmFtZSA9IHVzZUlmcmFtZUNvbnRyb2woKTsKICAgICAgaWZyYW1lLnVwZGF0ZURhdGFMaXN0ZW5lcigpOwogICAgICBpZnJhbWUuZ2V0VG9rZW5LZXkoKTsKICAgIH0sCiAgICBnZXRDb25maWdEYXRhOiBmdW5jdGlvbiBnZXRDb25maWdEYXRhKCkgewogICAgICBpZiAodGhpcy5jb25maWcpIHsKICAgICAgICB0aGlzLnNldFRva2VuKHRoaXMuY29uZmlnLmtleSk7CiAgICAgICAgdGhpcy5zZXRDdXN0b21lcih0aGlzLmNvbmZpZy5jdXN0b21lcik7CiAgICAgICAgdGhpcy5zZXRFZGl0TW9kZSh0aGlzLmNvbmZpZy5lZGl0KTsKICAgICAgfQogICAgfSwKICAgIHNob3dXaWRnZXRCeVVzZXI6IGZ1bmN0aW9uIHNob3dXaWRnZXRCeVVzZXIoKSB7CiAgICAgIHJldHVybiB3aWRnZXRVc2VDYXNlLmNhblNob3codGhpcy53aWRnZXQpOwogICAgfSwKICAgIHNldHVwOiBmdW5jdGlvbiBzZXR1cCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgc2hvdywgZGVsYXksIHZtOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfdGhpczIuZ2V0SWZyYW1lRGF0YSgpOyAvL0dldCBkYXRhIGluIGlmcmFtZQoKCiAgICAgICAgICAgICAgICBfdGhpczIuZ2V0Q29uZmlnRGF0YSgpOyAvL0dldCBkYXRhIGluIGNsYXNzIGNvbmZpZwoKCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMyLmdldFdpZGdldCgpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLndpZGdldCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgc2hvdyA9IF90aGlzMi5zaG93V2lkZ2V0QnlVc2VyKF90aGlzMi53aWRnZXQpOwoKICAgICAgICAgICAgICAgIGlmIChzaG93KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBkZWxheSA9IF90aGlzMi53aWRnZXQuZGVsYXkgfHwgMDsKICAgICAgICAgICAgICAgIHZtID0gX3RoaXMyOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICAgICAgICAgICAgICAgIHZtLnNob3dXaWRnZXQoc2hvdyk7CiAgICAgICAgICAgICAgICB9LCBkZWxheSAqIDEwMDApOwogICAgICAgICAgICAgICAgd2lkZ2V0VXNlQ2FzZS5zZXRTaG93QXQoKTsKICAgICAgICAgICAgICAgIHdpZGdldFVzZUNhc2UucG9zdE9wZW5Db3VudGVyKCk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICB9KSkoKTsKICAgIH0KICB9KSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy5zZXR1cCgpOwogIH0KfTs="},{"version":3,"sources":["Widget.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <Box :widget=\"widget\" v-if=\"widget && show\" />\n</template>\n<script>\nimport { mapMutations, mapState } from 'vuex'\nimport useIframeControl from '../../hooks/iframe'\n\nimport WidgetUseCase from '../../arch/widget/usecase'\nconst widgetUseCase = new WidgetUseCase()\n\nexport default {\n  components: {\n    Box: () => import('./Box'),\n  },\n  props: {\n    config: Object,\n  },\n  data() {\n    return {\n      widget: null,\n    }\n  },\n  computed: {\n    ...mapState({\n      customer: state => state.survey.customer,\n      token: state => state.survey.token,\n      show: state => state.survey.show,\n    }),\n  },\n  methods: {\n    ...mapMutations({\n      setToken: 'survey/setToken',\n      setCustomer: 'survey/setCustomer',\n      showWidget: 'survey/showWidget',\n      setEditMode: 'survey/setEditMode',\n    }),\n    async getWidget() {\n      const response = await widgetUseCase.getOne(this.token)\n      this.widget = response\n\n      if (!this.widget) {\n        return\n      }\n\n      //Remove non question items\n      this.widget = widgetUseCase.removeNonQuestionItems(this.widget)\n    },\n    getIframeData() {\n      const iframe = useIframeControl()\n      iframe.updateDataListener()\n      iframe.getTokenKey()\n    },\n    getConfigData() {\n      if (this.config) {\n        this.setToken(this.config.key)\n        this.setCustomer(this.config.customer)\n        this.setEditMode(this.config.edit)\n      }\n    },\n    showWidgetByUser() {\n      return widgetUseCase.canShow(this.widget)\n    },\n    async setup() {\n      this.getIframeData() //Get data in iframe\n      this.getConfigData() //Get data in class config\n      await this.getWidget()\n      if (!this.widget) {\n        return\n      }\n      const show = this.showWidgetByUser(this.widget)\n      if (!show) {\n        return\n      }\n\n      const delay = this.widget.delay || 0\n      const vm = this\n      setTimeout(() => {\n        // startTime = new Date().getTime()\n        vm.showWidget(show)\n      }, delay * 1000)\n\n      widgetUseCase.setShowAt()\n      widgetUseCase.postOpenCounter()\n    },\n  },\n  created() {\n    this.setup()\n  },\n}\n</script>\n"],"sourceRoot":"src/views/Widget"}]}